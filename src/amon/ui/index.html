<!doctype html>
<html lang="zh-Hant" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Amon｜Chat UI</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400,0,0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/styles/github.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({ startOnLoad: false, theme: "neutral" });
      window.__mermaid = mermaid;
    </script>
  </head>
  <body>
    <main class="page">
      <div class="ui-shell" id="ui-shell">
        <aside class="shell-sidebar" aria-label="主要導覽" data-i18n-attr="aria-label:a11y.sidebar">
          <h2>Amon UI</h2>
          <nav class="shell-nav segmented" id="shell-nav">
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="chat" data-route="chat" data-icon="chat" href="#/chat" data-i18n="nav.chat">對話</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="context" data-route="context" data-icon="dashboard" href="#/context" data-i18n="nav.context">情境</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="graph" data-route="graph" data-icon="hub" href="#/graph" data-i18n="nav.graph">流程圖</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="tools-skills" data-route="tools" data-icon="build" href="#/tools" data-i18n="nav.tools">工具與技能</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="config" data-route="config" data-icon="tune" href="#/config" data-i18n="nav.config">設定</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="logs-events" data-route="logs" data-icon="receipt_long" href="#/logs" data-i18n="nav.logs">日誌與事件</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="docs" data-route="docs" data-icon="description" href="#/docs" data-i18n="nav.docs">文件</a>
            <a class="shell-nav__item shell-nav__link segmented__item" data-shell-view="bill" data-route="billing" data-icon="payments" href="#/billing" data-i18n="nav.billing">計費</a>
          </nav>
        </aside>

        <section class="shell-main">
          <header class="shell-topbar" aria-label="工作列" data-i18n-attr="aria-label:a11y.topbar">
            <div class="shell-topbar__group">
              <label class="field-label shell-topbar__field">
                <span data-i18n="topbar.project">專案</span>
                <select id="project-select"></select>
              </label>
              <span class="shell-status shell-status--run pill pill--neutral" id="shell-run-status" title="尚未有 Run" data-i18n="status.run.idle" data-i18n-attr="title:tooltip.runIdle">尚未有 Run</span>
              <span class="shell-status shell-status--daemon pill pill--neutral" id="shell-daemon-status" title="尚未連線 daemon" data-i18n="status.daemon.idle" data-i18n-attr="title:tooltip.daemonIdle">尚未連線</span>
              <span class="shell-status shell-status--budget pill pill--neutral" id="shell-budget-status">Budget：NT$ 0 / NT$ 5,000</span>
            </div>
            <div class="shell-topbar__actions">
              <button type="button" class="btn btn--secondary secondary-btn shell-sidebar-toggle" id="toggle-sidebar" aria-label="收合側欄" data-i18n-attr="aria-label:topbar.toggleSidebar">☰</button>
              <button type="button" class="btn btn--secondary secondary-btn shell-context-toggle" id="toggle-context-panel" aria-expanded="true" data-i18n="topbar.toggleContext">收合右側面板</button>
            </div>
          </header>

          <div class="layout chat-layout" id="chat-layout">
            <section class="main-card card chat-panel">
          <header class="chat-header">
            <div>
              <h1>Amon Chat</h1>
              <p class="subtitle">請用自然語言操作專案與任務（支援 streaming）。</p>
            </div>
            <div class="chat-controls">
              <span class="chat-project-label" id="chat-project-label">目前專案：未指定專案</span>
              <button class="btn btn--secondary secondary-btn" id="refresh-context">刷新 Context</button>
            </div>
          </header>

          <section id="timeline" class="chat-timeline"></section>

          <div class="progress-bar" id="stream-progress" aria-hidden="true">
            <span></span>
          </div>

          <section id="plan-card" class="plan-card" hidden>
            <div class="plan-card__header">
              <h3>Plan Card</h3>
              <p>此操作需要確認才能繼續。</p>
            </div>
            <div class="plan-grid">
              <div>
                <h4>Commands</h4>
                <ul id="plan-commands" class="plan-list"></ul>
              </div>
              <div>
                <h4>Graph Patches</h4>
                <ul id="plan-patches" class="plan-list"></ul>
              </div>
            </div>
            <div class="plan-risk" id="plan-risk"></div>
            <pre id="plan-content"></pre>
            <div class="plan-card__actions">
              <button class="btn btn--secondary secondary-btn" id="plan-cancel">取消</button>
              <button class="btn btn--primary primary-btn" id="plan-confirm">確認執行</button>
            </div>
          </section>

          <form id="chat-form" class="chat-input">
            <div class="chat-input__main">
              <textarea id="chat-input" rows="4" placeholder="輸入你的需求，例如：建立專案 Amon Demo" data-i18n-attr="placeholder:placeholder.chatInput"></textarea>
              <div class="chat-input__toolbar">
                <label class="file-btn chip">
                  加入附件
                  <input id="chat-attachments" type="file" multiple accept="image/*,video/*,.pdf" />
                </label>
                <span class="chat-input__hint">支援圖片、PDF、影片；附件會以文字摘要送出。</span>
              </div>
              <div id="attachment-preview" class="attachment-preview"></div>
            </div>
            <button type="submit" class="btn btn--primary primary-btn">送出</button>
          </form>
        </section>
            <div class="context-resizer" id="context-resizer" role="separator" aria-label="調整右側面板寬度" aria-orientation="vertical"></div>

            <aside class="context-panel" id="context-panel">
          <h2>Thinking / Artifacts</h2>
          <div class="inspector-tabs segmented" role="tablist" aria-label="Inspector 切換" data-i18n-attr="aria-label:a11y.inspector.tablist">
            <button
              type="button"
              class="segmented__item inspector-tabs__button"
              id="inspector-tab-thinking"
              role="tab"
              aria-controls="inspector-thinking"
              aria-selected="true"
              tabindex="0"
              data-inspector-tab="thinking"
            >Thinking</button>
            <button
              type="button"
              class="segmented__item inspector-tabs__button"
              id="inspector-tab-artifacts"
              role="tab"
              aria-controls="inspector-artifacts"
              aria-selected="false"
              tabindex="-1"
              data-inspector-tab="artifacts"
            >Artifacts</button>
            <button
              type="button"
              class="segmented__item inspector-tabs__button"
              id="inspector-tab-execution"
              role="tab"
              aria-controls="inspector-execution"
              aria-selected="false"
              tabindex="-1"
              data-inspector-tab="execution"
            >Execution</button>
          </div>
          <div class="context-shell" id="context-shell" hidden>
            <article class="context-shell-card card card--kpi">
              <p class="context-shell-card__label">Memory</p>
              <strong id="card-memory">尚未同步</strong>
            </article>
            <article class="context-shell-card card card--kpi">
              <p class="context-shell-card__label">Run</p>
              <strong id="card-run-progress">尚未開始</strong>
            </article>
            <article class="context-shell-card card card--kpi">
              <p class="context-shell-card__label">Billing</p>
              <strong id="card-billing">NT$ 0</strong>
            </article>
            <article class="context-shell-card card card--kpi">
              <p class="context-shell-card__label">Pending</p>
              <strong id="card-pending-confirmations">0</strong>
            </article>
          </div>
          <div class="context-project" id="context-project" hidden>目前專案：未選擇</div>
          <p id="context-overview" class="context-overview" hidden>請先在上方選擇專案，右側內容會自動同步。</p>
          <section class="context-section" id="inspector-thinking">
            <h3>Thinking Inspector</h3>
            <section class="thinking-panel" id="thinking-panel">
              <div class="thinking-panel__header">
                <h3>Thinking 狀態</h3>
                <label class="field-label thinking-mode">
                  顯示模式
                  <select id="thinking-mode">
                    <option value="off">off</option>
                    <option value="brief" selected>brief</option>
                    <option value="verbose">verbose</option>
                  </select>
                </label>
              </div>
              <details open id="thinking-details">
                <summary id="thinking-summary">目前沒有 Thinking 事件</summary>
                <div id="thinking-detail" class="thinking-panel__detail"></div>
              </details>
              <p class="context-overview">說明：只有在 AI 正在串流回覆、產生計畫（Plan）或回傳工具結果時，這裡才會出現內容；待機時會顯示 idle。</p>
            </section>
          </section>
          <section class="context-section" id="inspector-execution" hidden>
            <section class="execution-timeline" id="execution-timeline" aria-label="Execution Timeline">
              <header class="execution-timeline__header">
                <h3>Execution Timeline</h3>
                <p>顯示 Thinking / Planning / Tool / Node 目前進度（部分可能由事件推測）。</p>
              </header>
              <div id="execution-accordion" class="execution-accordion"></div>
            </section>
          </section>
          <section class="context-section" id="inspector-artifacts" hidden>
            <h3>Artifacts Inspector</h3>
            <p class="context-overview" id="artifacts-overview">這裡僅顯示流程產生的檔案；對話紀錄請使用下方「下載對話紀錄」。</p>
            <div class="artifacts-empty__actions">
              <button type="button" class="btn btn--secondary secondary-btn small" id="artifacts-download-chat">下載對話紀錄</button>
            </div>
            <div id="artifacts-inspector-list" class="artifacts-inspector-list list-row-group"></div>
            <div id="artifacts-empty" class="artifacts-empty" hidden>
              <p>尚無 artifacts（可能是 run 尚未完成或此流程未產出檔案）。</p>
              <div class="artifacts-empty__actions">
                <button type="button" class="btn btn--secondary secondary-btn small" id="artifacts-go-run">前往 Thinking</button>
              </div>
            </div>
          </section>
            </aside>
          </div>


          <section class="main-card card bill-page" id="bill-page" hidden>
            <header class="bill-page__header">
              <div>
                <h2>Billing &amp; Usage</h2>
                <p class="subtitle">費用與用量概覽（依既有 Billing API 即時更新）。</p>
              </div>
              <button type="button" class="btn btn--secondary secondary-btn" id="bill-refresh">重新整理</button>
            </header>

            <div class="bill-kpis">
              <article class="bill-kpi-card card">
                <p class="bill-kpi-card__label">今日費用 / 用量</p>
                <strong id="bill-today">--</strong>
                <small>Today</small>
              </article>
              <article class="bill-kpi-card card">
                <p class="bill-kpi-card__label">專案累計費用 / 用量</p>
                <strong id="bill-project-total">--</strong>
                <small>Current cycle</small>
              </article>
              <article class="bill-kpi-card card">
                <p class="bill-kpi-card__label">automation / interactive</p>
                <strong id="bill-mode-summary">--</strong>
                <small>Mode split</small>
              </article>
              <article class="bill-kpi-card card">
                <p class="bill-kpi-card__label">目前 Run 費用</p>
                <strong id="bill-current-run">--</strong>
                <small>Current run</small>
              </article>
            </div>

            <article class="bill-surface-card card bill-chart-card">
              <header class="bill-section__header">
                <h3>Usage History</h3>
                <div class="segmented bill-range" role="tablist" aria-label="歷史區間">
                  <button type="button" class="segmented__item is-active" id="bill-range-7d" aria-pressed="true">7D</button>
                  <button type="button" class="segmented__item" id="bill-range-30d" aria-pressed="false">30D</button>
                  <button type="button" class="segmented__item" id="bill-range-all" aria-pressed="false">All</button>
                </div>
              </header>
              <div class="bill-chart-wrap">
                <canvas id="bill-run-chart" height="180" aria-label="每 run 花費長條圖"></canvas>
              </div>
            </article>

            <section class="bill-surface-card card">
              <header class="bill-section__header">
                <h3>Cost by Model</h3>
              </header>
              <div id="bill-breakdown-model" class="bill-model-scroller" role="list"></div>
            </section>

            <section class="bill-surface-card card">
              <header class="bill-section__header">
                <h3>Recent Sessions</h3>
              </header>
              <div id="bill-recent-sessions" class="list-row-group"></div>
            </section>

            <section class="bill-surface-card card bill-cta-card">
              <button type="button" class="btn btn--secondary secondary-btn" id="bill-download" disabled title="目前尚未提供下載 endpoint">下載帳單 CSV</button>
            </section>

            <section class="bill-grid">
              <article class="bill-surface-card card">
                <h3>Budgets</h3>
                <div id="bill-budgets" class="bill-list-rows"></div>
              </article>
              <article class="bill-surface-card card">
                <h3>超限事件（budget_exceeded）</h3>
                <ul id="bill-exceeded" class="logs-list list-row-group"></ul>
              </article>
            </section>

            <section class="bill-grid">
              <article class="bill-surface-card card">
                <h3>Breakdown：provider</h3>
                <div id="bill-breakdown-provider" class="bill-list-rows"></div>
              </article>
              <article class="bill-surface-card card">
                <h3>Breakdown：agent</h3>
                <div id="bill-breakdown-agent" class="bill-list-rows"></div>
              </article>
              <article class="bill-surface-card card">
                <h3>Breakdown：node</h3>
                <div id="bill-breakdown-node" class="bill-list-rows"></div>
              </article>
            </section>

            <details class="bill-raw-json card">
              <summary>Raw JSON（進階）</summary>
              <pre id="bill-raw-json">尚未載入。</pre>
            </details>
          </section>


          <section class="main-card card config-page" id="config-page" hidden>
            <header class="config-page__header">
              <div>
                <h2>Config</h2>
                <p class="subtitle">唯讀檢視 Global / Project / Effective 設定，並顯示 Effective 來源。</p>
              </div>
              <button type="button" class="btn btn--secondary secondary-btn" id="config-export">匯出 Effective Config</button>
            </header>

            <div class="config-toolbar">
              <label class="field-label config-toolbar__search">
                搜尋 key path
                <input type="search" id="config-search" placeholder="例如：amon.ui.theme" />
              </label>
              <button type="button" class="btn btn--secondary secondary-btn" id="config-refresh">重新整理</button>
            </div>

            <div class="config-grid">
              <article class="config-card card">
                <h3>Global config</h3>
                <pre id="config-global">尚未載入。</pre>
              </article>
              <article class="config-card card">
                <h3>Project config</h3>
                <pre id="config-project">尚未載入。</pre>
              </article>
            </div>

            <article class="config-card card">
              <h3>Effective config（含來源）</h3>
              <div id="config-effective-summary" class="config-effective-summary">尚未載入。</div>
              <div class="config-table-wrap">
                <table class="config-table" id="config-table">
                  <thead>
                    <tr>
                      <th>Key path</th>
                      <th>Effective</th>
                      <th>Source</th>
                    </tr>
                  </thead>
                  <tbody id="config-table-body"></tbody>
                </table>
              </div>
            </article>
          </section>

          <section class="main-card card logs-events-page" id="logs-events-page" hidden>
            <header class="logs-events-page__header">
              <div>
                <h2>Logs &amp; Events</h2>
                <p class="subtitle">依來源與條件檢視 log/event，並支援下載與 drilldown。</p>
              </div>
            </header>

            <section class="logs-panel">
              <h3>Logs</h3>
              <div class="logs-toolbar">
                <label class="field-label">來源
                  <select id="logs-source">
                    <option value="amon">amon</option>
                    <option value="project">project</option>
                    <option value="billing">billing</option>
                  </select>
                </label>
                <label class="field-label">起始時間<input type="datetime-local" id="logs-time-from" /></label>
                <label class="field-label">結束時間<input type="datetime-local" id="logs-time-to" /></label>
                <label class="field-label">project<input type="text" id="logs-filter-project" placeholder="project_id" /></label>
                <label class="field-label">run<input type="text" id="logs-filter-run" placeholder="run_id" /></label>
                <label class="field-label">node<input type="text" id="logs-filter-node" placeholder="node_id" /></label>
                <label class="field-label">severity
                  <select id="logs-filter-severity">
                    <option value="">全部</option>
                    <option value="INFO">INFO</option>
                    <option value="WARNING">WARNING</option>
                    <option value="ERROR">ERROR</option>
                  </select>
                </label>
                <label class="field-label">component<input type="text" id="logs-filter-component" placeholder="component / event" /></label>
                <button type="button" class="btn btn--secondary secondary-btn" id="logs-refresh">查詢</button>
                <button type="button" class="btn btn--secondary secondary-btn" id="logs-download">下載</button>
              </div>
              <div id="logs-summary" class="logs-summary">尚未載入。</div>
              <div id="logs-list" class="logs-list list-row-group"></div>
              <div class="pager" id="logs-pager">
                <button type="button" class="btn btn--secondary secondary-btn" id="logs-prev">上一頁</button>
                <span id="logs-page-label">第 1 頁</span>
                <button type="button" class="btn btn--secondary secondary-btn" id="logs-next">下一頁</button>
              </div>
            </section>

            <section class="events-panel">
              <h3>Events</h3>
              <div class="logs-toolbar">
                <label class="field-label">type<input type="text" id="events-filter-type" placeholder="event type" /></label>
                <label class="field-label">起始時間<input type="datetime-local" id="events-time-from" /></label>
                <label class="field-label">結束時間<input type="datetime-local" id="events-time-to" /></label>
                <label class="field-label">project<input type="text" id="events-filter-project" placeholder="project_id" /></label>
                <label class="field-label">run<input type="text" id="events-filter-run" placeholder="run_id" /></label>
                <label class="field-label">node<input type="text" id="events-filter-node" placeholder="node_id" /></label>
                <button type="button" class="btn btn--secondary secondary-btn" id="events-refresh">查詢</button>
              </div>
              <div id="events-summary" class="logs-summary">尚未載入。</div>
              <div id="events-list" class="logs-list list-row-group"></div>
              <div class="pager" id="events-pager">
                <button type="button" class="btn btn--secondary secondary-btn" id="events-prev">上一頁</button>
                <span id="events-page-label">第 1 頁</span>
                <button type="button" class="btn btn--secondary secondary-btn" id="events-next">下一頁</button>
              </div>
            </section>
          </section>

          <section class="main-card card context-page" id="context-page" hidden>
            <header class="context-page__header">
              <div>
                <h2>Context</h2>
                <p class="subtitle">Context Usage Dashboard（資料尚未串接時，將顯示為「尚未可取得」）。</p>
              </div>
              <div class="context-page__actions">
                <button type="button" class="btn btn--secondary secondary-btn" id="context-clear-chat">清空本次對話</button>
              </div>
            </header>

            <section class="context-dashboard" aria-label="Context Usage Dashboard">
              <article class="context-gauge card">
                <header class="context-gauge__header">
                  <h3>Usage Gauge</h3>
                  <span class="context-status-pill" id="context-usage-status">尚未可取得</span>
                </header>
                <div class="context-gauge__body">
                  <div class="context-gauge__canvas-wrap">
                    <canvas id="context-usage-chart" width="220" height="220" aria-label="Context 使用量圓環圖"></canvas>
                    <div class="context-gauge__center">
                      <strong id="context-usage-percent">--</strong>
                      <span>Usage</span>
                    </div>
                  </div>
                  <p class="context-gauge__meta" id="context-usage-meta">Token 使用量尚未可取得。</p>
                </div>
              </article>

              <div class="context-kpis">
                <article class="context-kpi card">
                  <p>Remaining</p>
                  <strong id="context-kpi-remaining">--</strong>
                  <small>尚未可取得</small>
                </article>
                <article class="context-kpi card">
                  <p>Est. Cost</p>
                  <strong id="context-kpi-cost">--</strong>
                  <small>尚未可取得</small>
                </article>
              </div>

              <article class="context-breakdown card">
                <header class="context-breakdown__header">
                  <h3>Breakdown</h3>
                  <span>Usage by source</span>
                </header>
                <ul class="context-breakdown__list" id="context-breakdown-list">
                  <li>
                    <div class="context-breakdown__label"><span>History</span><span>--</span></div>
                    <div class="context-breakdown__progress is-unavailable"><span></span></div>
                    <small>尚未可取得</small>
                  </li>
                  <li>
                    <div class="context-breakdown__label"><span>Tools</span><span>--</span></div>
                    <div class="context-breakdown__progress is-unavailable"><span></span></div>
                    <small>尚未可取得</small>
                  </li>
                  <li>
                    <div class="context-breakdown__label"><span>System</span><span>--</span></div>
                    <div class="context-breakdown__progress is-unavailable"><span></span></div>
                    <small>尚未可取得</small>
                  </li>
                  <li>
                    <div class="context-breakdown__label"><span>Plugins</span><span>--</span></div>
                    <div class="context-breakdown__progress is-unavailable"><span></span></div>
                    <small>尚未可取得</small>
                  </li>
                </ul>
              </article>
            </section>

            <section class="context-draft card" id="context-draft-box">
              <details open>
                <summary>Context 草稿與清理操作（僅本機）</summary>
                <div class="context-draft__content">
                  <label class="field-label" for="context-draft-input">Context 草稿（僅本機）</label>
                  <textarea id="context-draft-input" rows="8" placeholder="例如：專案目標、語氣偏好、重要限制條件..."></textarea>
                  <p id="context-draft-meta" class="context-draft__meta">尚未儲存草稿。</p>
                  <div class="context-draft__actions">
                    <button type="button" class="btn btn--primary primary-btn" id="context-save-draft">儲存草稿（本機）</button>
                    <label class="btn btn--secondary secondary-btn file-btn-inline" for="context-import-file">從檔案匯入</label>
                    <input id="context-import-file" type="file" accept=".txt,.md,.json" hidden />
                    <button type="button" class="btn btn--secondary secondary-btn" id="context-extract-chat">從最近對話擷取</button>
                  </div>

                  <section class="context-danger-zone">
                    <h3>清理動作</h3>
                    <p class="empty-context">高風險操作將需要二次確認。若為本機草稿清理，無法復原。</p>
                    <div class="context-danger-zone__actions">
                      <button type="button" class="btn btn--secondary secondary-btn" id="context-clear-project">清空專案 Context 草稿（本機）</button>
                    </div>
                  </section>
                </div>
              </details>
            </section>

            <footer class="context-page__footer card">
              <div>
                <strong>想提升可用 context 嗎？</strong>
                <p>先整理草稿並儲存，後續即可在聊天時快速套用。</p>
              </div>
              <button type="button" class="btn btn--primary primary-btn" id="context-save-draft-cta">儲存目前草稿</button>
            </footer>
          </section>

          <section class="main-card card graph-page" id="graph-page" hidden>
            <header class="graph-page__header">
              <div>
                <h2>Graph</h2>
                <p class="subtitle">流程圖主視圖（支援切換歷史 Run）。</p>
              </div>
              <div class="graph-page__controls">
                <label class="field-label">
                  歷史 Run
                  <select id="graph-run-select"></select>
                </label>
                <button type="button" class="btn btn--secondary secondary-btn" id="graph-history-refresh">重新整理</button>
                <button type="button" class="btn btn--secondary secondary-btn" id="copy-run-id" disabled data-i18n="button.copyRunId" data-i18n-attr="aria-label:button.copyRunIdAria">複製 Run ID</button>
              </div>
            </header>
            <div class="graph-toolbar">
              <div class="graph-run-meta-wrap">
                <span id="graph-run-meta" class="graph-run-meta">尚未偵測到 Run</span>
              </div>
              <div class="graph-toolbar__actions">
                <button type="button" class="btn btn--secondary secondary-btn" id="graph-create-template">Create template</button>
              </div>
            </div>
            <div id="graph-preview" class="graph-preview"></div>
            <ul id="graph-node-list" class="graph-node-list list-row-group"></ul>
            <pre id="graph-code" class="graph-code codeblock"></pre>
          </section>

          <section class="main-card card docs-page" id="docs-page" hidden>
            <header class="docs-page__header">
              <div>
                <h2>Docs</h2>
                <p class="subtitle">依 run/task 檢視文件，預覽 markdown，並插入 Chat 引用。</p>
              </div>
              <button type="button" class="btn btn--secondary secondary-btn" id="docs-refresh">重新整理</button>
            </header>
            <div class="docs-layout">
              <aside class="docs-tree" id="docs-tree-wrap">
                <div class="docs-tree__meta" id="docs-tree-meta">尚未載入。</div>
                <input type="search" id="docs-filter" class="docs-filter" placeholder="搜尋檔名或路徑（client-side）" data-i18n-attr="placeholder:placeholder.docsFilter" />
                <div class="docs-tree__viewport" id="docs-tree-viewport" role="list"></div>
              </aside>
              <article class="docs-preview">
                <header class="docs-preview__header">
                  <div>
                    <h3 id="docs-preview-title">請從左側選擇文件</h3>
                    <p id="docs-preview-meta" class="docs-preview__meta">來源 run / node 將顯示於此。</p>
                  </div>
                  <div class="docs-preview__actions">
                    <button type="button" class="btn btn--secondary secondary-btn" id="docs-open" disabled>Open</button>
                    <button type="button" class="btn btn--secondary secondary-btn" id="docs-download" disabled>Download</button>
                    <button type="button" class="btn btn--primary primary-btn" id="docs-insert" disabled>插入 @doc</button>
                  </div>
                </header>
                <div id="docs-preview-content" class="docs-preview__content">
                  <p class="empty-context">尚未選擇文件。</p>
                </div>
              </article>
            </div>
          </section>

          <section class="main-card card tools-skills-page" id="tools-skills-page" hidden>
            <header class="tools-skills-page__header">
              <div>
                <h2>Tools &amp; Skills</h2>
                <p class="subtitle">管理工具與技能清單；所有權限變更都必須經過 Plan Card 確認。</p>
              </div>
              <button type="button" class="btn btn--secondary secondary-btn" id="tools-skills-refresh">重新整理</button>
            </header>

            <section class="tools-section">
              <h3>Tools</h3>
              <div id="tools-list" class="tools-list list-row-group"></div>
            </section>

            <section class="skills-section">
              <h3>Skills</h3>
              <div id="skills-collisions" class="skills-collisions"></div>
              <div id="skills-list" class="skills-list list-row-group"></div>
            </section>

            <section class="skills-preview-section">
              <h3>注入預覽（不觸發模型）</h3>
              <div class="skills-preview-controls">
                <select id="skill-trigger-select"></select>
                <button type="button" class="btn btn--primary primary-btn" id="skill-trigger-preview">預覽注入內容</button>
              </div>
              <pre id="skill-injection-preview" class="skill-injection-preview codeblock">尚未產生預覽。</pre>
            </section>
          </section>
        </section>
      </div>
    </main>

    <div id="toast" class="toast toast--info" role="status" aria-live="polite"></div>
    <div id="confirm-modal" class="confirm-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="confirm-modal-title" aria-describedby="confirm-modal-description" hidden>
      <div class="confirm-modal__panel">
        <h3 class="confirm-modal__title" id="confirm-modal-title" data-confirm-title data-i18n="modal.confirm.title">請再次確認</h3>
        <p class="confirm-modal__description" id="confirm-modal-description" data-confirm-description data-i18n="modal.confirm.description">這個動作無法復原，是否繼續？</p>
        <div class="confirm-modal__actions">
          <button type="button" class="btn btn--secondary secondary-btn" data-confirm-cancel data-i18n="modal.confirm.cancel">取消</button>
          <button type="button" class="btn btn--primary primary-btn" data-confirm-ok data-i18n="modal.confirm.ok">確認</button>
        </div>
      </div>
    </div>

    <div id="artifact-preview-modal" class="artifact-preview-modal" role="dialog" aria-modal="true" aria-hidden="true" hidden>
      <div class="artifact-preview-modal__panel">
        <header class="artifact-preview-modal__header">
          <h3 id="artifact-preview-title">Artifact 預覽</h3>
          <button type="button" class="btn btn--secondary secondary-btn small" id="artifact-preview-close">關閉</button>
        </header>
        <div class="artifact-preview-modal__actions">
          <button type="button" class="btn btn--secondary secondary-btn small" id="artifact-preview-download">下載檔案</button>
          <button type="button" class="btn btn--secondary secondary-btn small" id="artifact-preview-copy" hidden>複製內容</button>
        </div>
        <div id="artifact-preview-body" class="artifact-preview-modal__body"></div>
      </div>
    </div>
    <aside id="graph-node-drawer" class="graph-node-drawer" hidden>
      <header class="graph-node-drawer__header">
        <h3 id="graph-node-title">Node 詳細</h3>
        <button type="button" class="btn btn--secondary secondary-btn" id="graph-node-close" data-i18n-attr="aria-label:button.collapseGraphNode">關閉</button>
      </header>
      <div class="graph-node-drawer__meta" id="graph-node-meta"></div>
      <section>
        <h4>inputs</h4>
        <details open>
          <summary>展開內容</summary>
          <pre id="graph-node-inputs" class="graph-node-json"></pre>
        </details>
      </section>
      <section>
        <h4>outputs（docs/artifacts）</h4>
        <pre id="graph-node-outputs" class="graph-node-json"></pre>
      </section>
      <section>
        <h4>最近 events/logs</h4>
        <ul id="graph-node-events" class="graph-node-events"></ul>
      </section>
      <section>
        <h4>Template 化</h4>
        <div class="graph-node-drawer__actions">
          <button type="button" class="btn btn--secondary secondary-btn" id="graph-parametrize">Parametrize（改成 {{var}}）</button>
        </div>
      </section>
    </aside>

    <script src="/event_stream_client.js"></script>
    <script type="module" src="/static/js/app.js"></script>
  </body>
</html>
